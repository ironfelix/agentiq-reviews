# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç—á—ë—Ç–∞ ‚Äî –°—Ç–∞—Ç–∏–∫–∞ vs –î–∏–Ω–∞–º–∏–∫–∞

> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–∞–Ω–Ω—ã–º –≤ –æ—Ç—á—ë—Ç–µ: —á—Ç–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–æ, —á—Ç–æ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞

---

## üìä –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON

–û—Ç—á—ë—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –∫–∞–∫ JSON –≤ –ø–æ–ª–µ `reports.data`. –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

```json
{
  "header": { ... },
  "signal": { ... },
  "reasons": { ... },
  "compare": { ... },
  "risk": { ... },
  "actions": { ... },
  "reply": { ... }
}
```

---

## 1. HEADER ‚Äî –®–∞–ø–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏

### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
–ê—Ä—Ç–∏–∫—É–ª 370907224
577 –æ—Ç–∑—ã–≤–æ–≤ | —Ä–µ–π—Ç–∏–Ω–≥ 4.82 | 0 –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
```

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç–∏–∫–∞/–î–∏–Ω–∞–º–∏–∫–∞ |
|------|----------|------------------|
| `article_id` | `report.article_id` (–ë–î) | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ |
| `feedback_count` | `report.feedback_count` (–ë–î) | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ (–∏–∑ WBCON API) |
| `rating` | `report.rating` (–ë–î) | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ (–∏–∑ WBCON API) |
| `unanswered_count` | Hardcoded: `0` | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ (TODO: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å) |
| `product_name` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è: `"–ê—Ä—Ç–∏–∫—É–ª {article_id}"` | üî∂ –ü–æ–ª—É—Å—Ç–∞—Ç–∏–∫–∞ (–Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ WB) |

### –ö–æ–¥ (backend/main.py):
```python
data["header"]["feedback_count"] = report.feedback_count or 0
data["header"]["rating"] = report.rating or 0
data["header"]["unanswered_count"] = 0  # TODO: calculate
data["header"]["product_name"] = f"–ê—Ä—Ç–∏–∫—É–ª {report.article_id}"
```

---

## 2. SIGNAL ‚Äî –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
‚ö† –ü–†–û–ë–õ–ï–ú–ê –í –†–ï–ñ–ò–ú–ï: –ß–ï–†–ù–´–ô –°–ü–ï–ö–¢–†
–†–µ–π—Ç–∏–Ω–≥ –Ω–∏–∂–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
–ü—Ä–∏—á–∏–Ω–∞: –ù–µ –¥–µ—Ä–∂–∏—Ç –≤–æ–¥—É / –≤–ª–∞–≥—É
–†–∏—Å–∫ –ø–∞–¥–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–∫–∏

800 –æ—Ç–∑—ã–≤–æ–≤, –¥–æ–≤–µ—Ä–∏–µ: —Å—Ä–µ–¥–Ω–µ–µ

[–í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞]
—á–µ—Ä–Ω—ã–π: 4.50 ‚≠ê
```

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç–∏–∫–∞/–î–∏–Ω–∞–º–∏–∫–∞ |
|------|----------|------------------|
| `signal.title` | `wbcon-task-to-card-v2.py` | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ target_variant) |
| `signal.summary` | `wbcon-task-to-card-v2.py` | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ (–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã) |
| `signal.meta` | `wbcon-task-to-card-v2.py` | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ (–∫–æ–ª-–≤–æ –æ—Ç–∑—ã–≤–æ–≤, –¥–æ–≤–µ—Ä–∏–µ) |
| `signal.scores[]` | `wbcon-task-to-card-v2.py` | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ (—Ä–µ–π—Ç–∏–Ω–≥–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤) |
| `signal.scores[].label` | –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ `color` –ø–æ–ª—è –æ—Ç–∑—ã–≤–æ–≤ | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ |
| `signal.scores[].value` | –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: —Å—Ä–µ–¥–Ω–∏–π `valuation` –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ |

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (wbcon-task-to-card-v2.py):
```python
# –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Ü–≤–µ—Ç/—Ä–∞–∑–º–µ—Ä —Å –Ω–∏–∑–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º)
target_variant = find_target_variant(feedbacks)

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫
signal["title"] = f"‚ö† –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–µ–∂–∏–º–µ: {target_variant}"

# –°—á–∏—Ç–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
variant_ratings = calculate_variant_ratings(feedbacks)
signal["scores"] = [
    {"label": variant, "value": rating}
    for variant, rating in variant_ratings.items()
]
```

---

## 3. REASONS ‚Äî –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
üíß –ù–µ –¥–µ—Ä–∂–∏—Ç –≤–æ–¥—É / –≤–ª–∞–≥—É     43%
üîß –ë—Ä–∞–∫ / –¥–µ—Ñ–µ–∫—Ç               29%
‚ùì –ü—Ä–æ—á–µ–µ                      14%
üîã –ë—ã—Å—Ç—Ä–æ —Å–∞–¥–∏—Ç—Å—è –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä  14%
```

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç–∏–∫–∞/–î–∏–Ω–∞–º–∏–∫–∞ |
|------|----------|------------------|
| `reasons.items[].label` | –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤ –æ—Ç–∑—ã–≤–æ–≤ (keyword matching) | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ |
| `reasons.items[].emoji` | –ú–∞–ø–ø–∏–Ω–≥ –≤ —Å–∫—Ä–∏–ø—Ç–µ: UNIVERSAL_REASONS / CATEGORY_REASONS | üî∂ –ü–æ–ª—É—Å—Ç–∞—Ç–∏–∫–∞ (emoji —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã) |
| `reasons.items[].count` | –ü–æ–¥—Å—á—ë—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ –æ—Ç–∑—ã–≤–∞—Ö | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ |
| `reasons.items[].share` | –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ | ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞ |

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (wbcon-task-to-card-v2.py):
```python
# –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–∏—á–∏–Ω (—Å—Ç–∞—Ç–∏–∫–∞)
UNIVERSAL_REASONS = {
    "defect": {
        "label": "–ë—Ä–∞–∫ / –¥–µ—Ñ–µ–∫—Ç",
        "emoji": "üîß",
        "patterns": ["–±—Ä–∞–∫", "–¥–µ—Ñ–µ–∫—Ç", "—Å–ª–æ–º–∞–ª", "–Ω–µ —Ä–∞–±–æ—Ç–∞"],
    },
    # ...
}

# –ü–æ–¥—Å—á—ë—Ç (–¥–∏–Ω–∞–º–∏–∫–∞)
for feedback in feedbacks:
    text = feedback.get("fb_text", "").lower()
    for reason_key, reason_config in UNIVERSAL_REASONS.items():
        if any(pattern in text for pattern in reason_config["patterns"]):
            reason_counts[reason_key] += 1
```

---

## 4. COMPARE ‚Äî –°—Ä–∞–≤–Ω–µ–Ω–∏–µ (–ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### –°—Ç–∞—Ç—É—Å: ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–æ–≤–∞—Ä–∞
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
- –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

---

## 5. RISK ‚Äî –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫

### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
–í–µ—Ä–æ—è—Ç–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏: ‚Äì3‚Äì6%
–†–æ—Å—Ç –Ω–µ–≥–∞—Ç–∏–≤–∞ –≤ —Ä–µ–∫–ª–∞–º–µ
–†–∏—Å–∫ –ø–∞–¥–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
```

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç–∏–∫–∞/–î–∏–Ω–∞–º–∏–∫–∞ |
|------|----------|------------------|
| `risk.items[]` | Hardcoded —Ç–µ–∫—Å—Ç –≤ —Å–∫—Ä–∏–ø—Ç–µ | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ (TODO: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∏—Å–∫–∏) |
| `risk.note` | Hardcoded: "–û—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö" | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ |

### –ö–æ–¥ (wbcon-task-to-card-v2.py):
```python
"risk": {
    "title": "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫",
    "items": [
        "–í–µ—Ä–æ—è—Ç–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏: ‚Äì3‚Äì6%",  # ‚ùå –°—Ç–∞—Ç–∏–∫–∞
        "–†–æ—Å—Ç –Ω–µ–≥–∞—Ç–∏–≤–∞ –≤ —Ä–µ–∫–ª–∞–º–µ",              # ‚ùå –°—Ç–∞—Ç–∏–∫–∞
        "–†–∏—Å–∫ –ø–∞–¥–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–∫–∏"        # ‚ùå –°—Ç–∞—Ç–∏–∫–∞
    ],
    "note": "–û—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ WB"  # ‚ùå –°—Ç–∞—Ç–∏–∫–∞
}
```

---

## 6. ACTIONS ‚Äî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
‚Üí –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Ç–∏–∏ —Ä–µ–∂–∏–º–∞ ¬´—á–µ—Ä–Ω—ã–π¬ª –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
‚Ä¢ –°–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–Ω—É—é —è—Ä–∫–æ—Å—Ç—å —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π        ‚Üê ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê!
‚Ä¢ –û–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ: –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ —è—Ä–∫–æ—Å—Ç–∏          ‚Üê ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê!
‚Ä¢ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –ø–æ —à–∞–±–ª–æ–Ω—É
```

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç–∏–∫–∞/–î–∏–Ω–∞–º–∏–∫–∞ |
|------|----------|------------------|
| `actions.items[]` | –®–∞–±–ª–æ–Ω—ã –∏–∑ `get_actions(category)` | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) |
| `actions.items[0]` | –î–∏–Ω–∞–º–∏–∫–∞: –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è `target_variant` | üî∂ –ü–æ–ª—É—Å—Ç–∞—Ç–∏–∫–∞ |
| `actions.status` | Hardcoded: "‚è≥ –ü–æ–¥ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º..." | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ |

### **–ü–†–û–ë–õ–ï–ú–ê:** Actions —Å—Ç–∞—Ç–∏—á–Ω—ã –∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

```python
# wbcon-task-to-card-v2.py
base_actions = {
    "flashlight": [  # ‚Üê –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        "–°–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–Ω—É—é —è—Ä–∫–æ—Å—Ç—å —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π",  # ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —á–∞–π–Ω–∏–∫–∞!
        "–û–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ: –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ —è—Ä–∫–æ—Å—Ç–∏",    # ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —á–∞–π–Ω–∏–∫–∞!
    ],
    "kitchen": [  # ‚Üê –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å!
        "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—å –∫—Ä—ã—à–∫–∏",
        "–°–≤–µ—Ä–∏—Ç—å –æ–±—ä—ë–º —á–∞–π–Ω–∏–∫–∞ —Å –∑–∞—è–≤–ª–µ–Ω–Ω—ã–º",
    ]
}
```

### **TODO: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å actions –∏–∑ reasons**
```python
# –ò–¥–µ—è: actions –¥–æ–ª–∂–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω
if "–ù–µ –¥–µ—Ä–∂–∏—Ç –≤–æ–¥—É" in top_reasons:
    actions.append("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—å –∫—Ä—ã—à–∫–∏ –∏ —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–π")
if "–ë—Ä–∞–∫" in top_reasons:
    actions.append("–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º –ø–æ –ø–∞—Ä—Ç–∏—è–º")
```

---

## 7. REPLY ‚Äî –ß–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç–≤–µ—Ç–∞

### –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
–ß–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç–≤–µ—Ç–∞ (–∞–≤—Ç–æ)
¬´–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤. –ù–∞–º –≤–∞–∂–Ω–æ –≤–∞—à–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –ø–æ —è—Ä–∫–æ—Å—Ç–∏...¬ª
```

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è:

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç–∏–∫–∞/–î–∏–Ω–∞–º–∏–∫–∞ |
|------|----------|------------------|
| `reply.draft` | –®–∞–±–ª–æ–Ω –∏–∑ `get_reply_draft(category, target_variant)` | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ (—à–∞–±–ª–æ–Ω) |
| `reply.note` | Hardcoded: "–û—Ç–≤–µ—Ç –Ω–µ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É..." | ‚ùå –°—Ç–∞—Ç–∏–∫–∞ |

### –ö–æ–¥ (wbcon-task-to-card-v2.py):
```python
def get_reply_draft(category: str, target_variant: str) -> str:
    templates = {
        "flashlight": f"–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤. –ù–∞–º –≤–∞–∂–Ω–æ –≤–∞—à–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –ø–æ —è—Ä–∫–æ—Å—Ç–∏ —Ä–µ–∂–∏–º–∞ ¬´{target_variant}¬ª...",
        "kitchen": f"–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤. –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—å –∏–∑–¥–µ–ª–∏—è...",
    }
    return templates.get(category, "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–∑—ã–≤...")
```

---

## üìã –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | TODO |
|-----------|----------|-----------|------|
| **Categories** | –¢–æ–ª—å–∫–æ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (flashlight, clothing, electronics, pet_food) | üî¥ –í—ã—Å–æ–∫–∏–π | –î–æ–±–∞–≤–∏—Ç—å: kitchen, home, toys, beauty, auto, sports |
| **Category Detection** | Fallback –Ω–∞ "flashlight" –ø—Ä–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | üî¥ –í—ã—Å–æ–∫–∏–π | –£–ª—É—á—à–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º, –¥–æ–±–∞–≤–∏—Ç—å ML-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| **Actions** | –®–∞–±–ª–æ–Ω–Ω—ã–µ, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º | üî¥ –í—ã—Å–æ–∫–∏–π | –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ reasons, –∞ –Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| **Reply Draft** | –®–∞–±–ª–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π | üü° –°—Ä–µ–¥–Ω–∏–π | –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —É—á—ë—Ç–æ–º top_reason |
| **Risk** | –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç | üü° –°—Ä–µ–¥–Ω–∏–π | –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ (–ø–∞–¥–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞, –ø–æ—Ç–µ—Ä—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏) |
| **Product Name** | –ù–µ –ø–∞—Ä—Å–∏—Ç—Å—è –∏–∑ WB API | üü¢ –ù–∏–∑–∫–∏–π | –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ WB Card API |
| **Unanswered Count** | –í—Å–µ–≥–¥–∞ 0 | üü¢ –ù–∏–∑–∫–∏–π | –°—á–∏—Ç–∞—Ç—å –æ—Ç–∑—ã–≤—ã –±–µ–∑ `answer_text` |

---

## üîß –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### Backend (FastAPI) ‚Äî –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ template

```python
# backend/main.py - endpoint /report/{task_id}

# 1. –î–æ—Å—Ç–∞—ë–º –æ—Ç—á—ë—Ç –∏–∑ –ë–î
report = db.query(Report).filter(Report.task_id == task_id).first()

# 2. –ü–∞—Ä—Å–∏–º JSON
data = json.loads(report.data)

# 3. –î–æ–ø–æ–ª–Ω—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –∏–∑ –º–æ–¥–µ–ª–∏
data["header"]["feedback_count"] = report.feedback_count  # ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞
data["header"]["rating"] = report.rating                 # ‚úÖ –î–∏–Ω–∞–º–∏–∫–∞
data["header"]["product_name"] = f"–ê—Ä—Ç–∏–∫—É–ª {report.article_id}"  # üî∂ –ü–æ–ª—É—Å—Ç–∞—Ç–∏–∫–∞

# 4. –†–µ–Ω–¥–µ—Ä–∏–º template
return templates.TemplateResponse("report.html", {
    "report": report,
    "data": data
})
```

### Template (Jinja2) ‚Äî –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ HTML

```html
<!-- templates/report.html -->

<!-- –®–∞–ø–∫–∞ -->
<h4>{{ data.header.product_name }}</h4>
<span>{{ report.article_id }}</span>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div>{{ data.header.feedback_count }} –æ—Ç–∑—ã–≤–æ–≤</div>
<div>{{ "%.2f"|format(data.header.rating) }} —Ä–µ–π—Ç–∏–Ω–≥</div>

<!-- –°–∏–≥–Ω–∞–ª -->
<span>{{ data.signal.title }}</span>
<p>{{ data.signal.summary }}</p>

<!-- –ü—Ä–∏—á–∏–Ω—ã -->
{% for reason in data.reasons.items %}
  <div>{{ reason.emoji }} {{ reason.label }} - {{ reason.share }}%</div>
{% endfor %}

<!-- Actions -->
{% for action in data.actions.items %}
  <li>{{ action }}</li>
{% endfor %}
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

```python
# wbcon-task-to-card-v2.py
CATEGORY_KEYWORDS = {
    "flashlight": ["—Ñ–æ–Ω–∞—Ä", "–Ω–∞–ª–æ–±–Ω", "—Å–≤–µ—Ç–æ–¥–∏–æ–¥"],
    "clothing": ["–ø–ª–∞—Ç—å–µ", "–∫—É—Ä—Ç–∫–∞", "–æ–¥–µ–∂–¥"],
    "electronics": ["–Ω–∞—É—à–Ω–∏–∫", "–∫–æ–ª–æ–Ω–∫", "–∑–∞—Ä—è–¥–∫"],
    "pet_food": ["–∫–æ—Ä–º", "–∫–æ—à–∫", "—Å–æ–±–∞–∫"],

    # ‚úÖ –î–æ–±–∞–≤–∏—Ç—å:
    "kitchen": ["—á–∞–π–Ω–∏–∫", "–∫–∞—Å—Ç—Ä—é–ª", "—Å–∫–æ–≤–æ—Ä–æ–¥", "—Ç–µ—Ä–º–æ—Å", "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"],
    "home": ["–ø–æ—Å—Ç–µ–ª—å", "–ø–æ–ª–æ—Ç–µ–Ω—Ü", "–ø–æ–¥—É—à–∫", "–æ–¥–µ—è–ª–æ"],
    "beauty": ["–∫—Ä–µ–º", "–º–∞—Å–∫–∞", "—à–∞–º–ø—É–Ω—å", "–∫–æ—Å–º–µ—Ç–∏–∫"],
    "toys": ["–∏–≥—Ä—É—à–∫", "–∫—É–∫–ª", "–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä", "–º–∞—à–∏–Ω–∫"],
    "auto": ["–∞–≤—Ç–æ–º–æ–±–∏–ª", "—à–∏–Ω—ã", "–º–∞—Å–ª–æ", "–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä"],
}
```

### 2. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Actions –∏–∑ Reasons

```python
def generate_actions_from_reasons(reasons: list, category: str, target_variant: str) -> list:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω."""
    actions = []

    # –ë–∞–∑–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Ç–∏–∏
    actions.append(f"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä—Ç–∏–∏ {'—Ä–µ–∂–∏–º–∞ ¬´' + target_variant + '¬ª' if target_variant else '—Ç–æ–≤–∞—Ä–∞'} –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π")

    # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏—á–∏–Ω
    top_reason = reasons[0]["label"] if reasons else ""

    if "–≤–æ–¥" in top_reason.lower() or "–≤–ª–∞–≥" in top_reason.lower():
        actions.append("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç—å –∫—Ä—ã—à–∫–∏ –∏ —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–π")
    elif "—è—Ä–∫–æ—Å—Ç—å" in top_reason.lower() or "—Å–≤–µ—Ç" in top_reason.lower():
        actions.append("–°–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–Ω—É—é —è—Ä–∫–æ—Å—Ç—å —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π")
    elif "—Ä–∞–∑–º–µ—Ä" in top_reason.lower():
        actions.append("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ–π —Å–µ—Ç–∫–∏")
    elif "–±–∞—Ç–∞—Ä–µ" in top_reason.lower() or "–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä" in top_reason.lower():
        actions.append("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ë–º–∫–æ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–∏ –∏ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã")
    else:
        actions.append("–°–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏")

    # –í—Å–µ–≥–¥–∞: –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
    actions.append("–û–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å —É—á—ë—Ç–æ–º –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º")

    # –í—Å–µ–≥–¥–∞: –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤—ã
    actions.append("–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –ø–æ —à–∞–±–ª–æ–Ω—É (–Ω–∏–∂–µ)")

    return actions
```

### 3. –£–ª—É—á—à–∏—Ç—å Category Detection

```python
def detect_category_improved(product_name: str = None, feedbacks: list = None) -> str:
    """–£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å ML-–ø–æ–¥—Ö–æ–¥–æ–º."""

    # 1. –ó–∞–ø—Ä–æ—Å –∫ WB API –∑–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
    if product_name:
        wb_category = get_wb_category(product_name)  # TODO: implement
        if wb_category in CATEGORY_MAP:
            return CATEGORY_MAP[wb_category]

    # 2. Keyword matching —Å –≤–µ—Å–∞–º–∏
    # 3. –ß–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–ª–æ–≤ –≤ –æ—Ç–∑—ã–≤–∞—Ö
    # 4. Fallback: "general" –≤–º–µ—Å—Ç–æ "flashlight"

    return "general"  # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

1. ‚úÖ **Extraction reasons** ‚Äî –ø—Ä–∏—á–∏–Ω—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤ –æ—Ç–∑—ã–≤–æ–≤
2. ‚úÖ **Variant comparison** ‚Äî —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º (—Ü–≤–µ—Ç/—Ä–∞–∑–º–µ—Ä) —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ **Target variant detection** ‚Äî –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –Ω–∏–∑–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
4. ‚úÖ **Feedback count & rating** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ WBCON API
5. ‚úÖ **JSON structure** ‚Äî —á–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è

---

**–°—Ç–∞—Ç—É—Å:** üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-05
**–ê–≤—Ç–æ—Ä:** Claude + Ivan

**Related:**
- [CARD_FORMAT.md](../CARD_FORMAT.md) ‚Äî –§–æ—Ä–º–∞—Ç JSON –∫–∞—Ä—Ç–æ—á–∫–∏
- [wbcon-task-to-card-v2.py](../wbcon-task-to-card-v2.py) ‚Äî –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞
- [templates/report.html](templates/report.html) ‚Äî Template –æ—Ç—á—ë—Ç–∞
