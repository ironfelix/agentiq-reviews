# Spec-Driven Rules (AgentIQ)

Last updated: 2026-02-13
Status: active

Ниже - правила для спеки как "контракта", по которому пишется и ревьюится код (в т.ч. AI-сгенерированный).

## 1. Source Of Truth
- Спека - источник правды. Если код и спека расходятся, правим либо код, либо спеку.
- Любые "домыслы" (не описанные в спеке) запрещены: сначала уточняем/дописываем спеку.

## 2. Язык требований
- Для критичных требований используем RFC 2119 стиль: MUST / MUST NOT / SHOULD / MAY.
- Формулировки вида "обычно", "примерно", "как-то" заменяем на конкретные правила.

## 3. Обязательные секции (минимум)
В каждой спеке должны быть:
- Goal / Non-goals
- Context (предпосылки, ссылки на существующие правила/доки)
- Interfaces (входы/выходы, форматы, схемы)
- Behavior (точные правила, включая edge cases)
- Errors (ошибки/коды/поведение)
- Security & Privacy (PII, токены, секреты, доступы)
- Performance (лимиты, пагинация, таймауты, idempotency где надо)
- Observability (логи/метрики, что считать инцидентом)
- Acceptance criteria (проверяемые пункты)
- Tests (какие тесты, где, какие фикстуры)

## 4. "Функциональная спека" (если просишь на каждую функцию)
Для функций, на которые пишем спеку, минимальный контракт:
- Signature (входы/выходы; типы если есть)
- Preconditions / Postconditions
- Determinism (детерминировано ли; если нет - почему и как стабилизируем)
- Side effects (I/O, БД, сеть)
- Error model (исключения/коды)
- Invariants (что никогда не должно нарушаться)
- Examples (1-3 примера вход->выход)

## 5. Запреты (guardrails)
- MUST NOT: принимать AI-код без ревью по спеке и тестам ("vibe coding").
- MUST NOT: добавлять новые зависимости без явного пункта в спеке (и причины).
- MUST NOT: логировать секреты/PII.
- MUST: задавать явно источники данных и приоритеты (например WB API first и т.д.).
- MUST: описывать idempotency для задач синка/воркеров.

## 6. Трассируемость
- В спеке указываем:
  - `Related code:` конкретные файлы/эндпоинты
  - `Related docs:` ссылки на другие доки проекта
  - `Rollout:` флаги, миграции, обратимость

